<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Geographically Optimal Similarity (GOS) and the Third Law of Geography in R • geosimilarity</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="../deps/MathJax-3.2.2/tex-chtml.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Geographically Optimal Similarity (GOS) and the Third Law of Geography in R">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">geosimilarity</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.8</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes">
<li><a class="dropdown-item" href="../articles/geosimilarity.html">Geographically Optimal Similarity (GOS) and the Third Law of Geography in R</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ausgis/geosimilarity/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Geographically Optimal Similarity (GOS) and the Third Law of Geography in R</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ausgis/geosimilarity/blob/main/vignettes/geosimilarity.Rmd" class="external-link"><code>vignettes/geosimilarity.Rmd</code></a></small>
      <div class="d-none name"><code>geosimilarity.Rmd</code></div>
    </div>

    
    
<p> </p>
<div class="section level3">
<h3 id="citation-for-package-geosimilarity">Citation for package <code>geosimilarity</code><a class="anchor" aria-label="anchor" href="#citation-for-package-geosimilarity"></a>
</h3>
<p>To cite <strong><code>geosimilarity</code> R package</strong> in
publications, please use:</p>
<p><strong>Song, Y. (2022) “Geographically Optimal Similarity”,
Mathematical Geosciences. doi: <a href="https://doi.org/10.1007/s11004-022-10036-8" class="external-link">10.1007/s11004-022-10036-8</a>.</strong></p>
<p> </p>
<p> </p>
</div>
<div class="section level2">
<h2 id="introduction-to-geosimilarity-package">1. Introduction to <code>geosimilarity</code> package<a class="anchor" aria-label="anchor" href="#introduction-to-geosimilarity-package"></a>
</h2>
<p><em>The package can be used to address following issues:</em></p>
<ul>
<li><p>Geographically optimal similarity (GOS) modeling.</p></li>
<li><p>Modeling the Third Law of Geography (i.e., basic configuration
similarity (BCS) model).</p></li>
<li><p>Spatial prediction.</p></li>
</ul>
<p>More details of GOS models can be found in <a href="https://doi.org/10.1007/s11004-022-10036-8" class="external-link">Song (2022)</a>.</p>
<p> </p>
</div>
<div class="section level2">
<h2 id="spatial-prediction-using-gos-model">2. Spatial prediction using GOS model<a class="anchor" aria-label="anchor" href="#spatial-prediction-using-gos-model"></a>
</h2>
<p>According to <a href="https://doi.org/10.1007/s11004-022-10036-8" class="external-link">Song (2022)</a>, GOS
model consists of four primary steps: (1) Characterizing geographical
configurations, (2) determining parameters for the optimal similarity,
(3) spatial prediction using GOS and uncertainty assessment, and (4)
model evaluation. The process of using <code>geosimilarity</code>
package to conduct GOS modeling is presented as follows.</p>
<div class="section level3">
<h3 id="characterizing-geographical-configurations">2.1 Characterizing geographical configurations<a class="anchor" aria-label="anchor" href="#characterizing-geographical-configurations"></a>
</h3>
<p>The <code>geosimilarity</code> package contains two spatial
datasets:</p>
<ul>
<li><p><code>zn</code>: Spatial samples of Zn concentrations and
explanatory variables at sample locations</p></li>
<li><p><code>grid</code>: Spatial grid data of explanatory variables
used for the prediction</p></li>
</ul>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"geosimilarity"</span>, dependencies <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># or run the following code:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"geosimilarity"</span>, dep <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ausgis/geosimilarity" class="external-link">geosimilarity</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"zn"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">zn</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 6 × 12</span></span>
<span><span class="co">##     Lon   Lat    Zn Elevation Slope Aspect  Water  NDVI   SOC    pH    Road  Mine</span></span>
<span><span class="co">##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">## 1  120. -28.5    10      455. 0.236  306.  0.014  0.184 0.909  5.95 49.4     55.6</span></span>
<span><span class="co">## 2  120. -28.4    30      451. 0.207  293.  2.20   0.202 0.906  6.05 49.0     51.1</span></span>
<span><span class="co">## 3  120. -28.4    30      443. 0.285  325.  0.0119 0.163 0.848  5.76 45.1     45.0</span></span>
<span><span class="co">## 4  120. -27.4    30      509. 0.236   98.4 3.06   0.204 0.851  5.82  0.0774  49.0</span></span>
<span><span class="co">## 5  120. -28.3    33      427. 0.191  329.  3.53   0.179 0.933  5.85 39.9     39.8</span></span>
<span><span class="co">## 6  120. -27.3    27      510. 0.211  105.  3.38   0.191 0.868  6.07  0.0468  48.7</span></span></code></pre></div>
<p>Data pre-processing and variable selection:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># log-transformation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">zn</span><span class="op">$</span><span class="va">Zn</span><span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/correlation-1.png"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">zn</span><span class="op">$</span><span class="va">Zn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">zn</span><span class="op">$</span><span class="va">Zn</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">zn</span><span class="op">$</span><span class="va">Zn</span><span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/correlation-2.png"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># remove outliers</span></span>
<span><span class="va">k</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/removeoutlier.html">removeoutlier</a></span><span class="op">(</span><span class="va">zn</span><span class="op">$</span><span class="va">Zn</span>, coef <span class="op">=</span> <span class="fl">2.5</span><span class="op">)</span></span>
<span><span class="co">## Remove 9 outlier(s)</span></span>
<span><span class="va">dt</span> <span class="op">&lt;-</span> <span class="va">zn</span><span class="op">[</span><span class="op">-</span><span class="va">k</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co"># correlation</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/braverock/PerformanceAnalytics" class="external-link">"PerformanceAnalytics"</a></span><span class="op">)</span></span>
<span><span class="co">## Loading required package: xts</span></span>
<span><span class="co">## Loading required package: zoo</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'zoo'</span></span>
<span><span class="co">## The following objects are masked from 'package:base':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     as.Date, as.Date.numeric</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'PerformanceAnalytics'</span></span>
<span><span class="co">## The following object is masked from 'package:graphics':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     legend</span></span>
<span><span class="va">cor_dt</span> <span class="op">&lt;-</span> <span class="va">dt</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span><span class="op">:</span><span class="fl">12</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/PerformanceAnalytics/man/chart.Correlation.html" class="external-link">chart.Correlation</a></span><span class="op">(</span><span class="va">cor_dt</span>, histogram <span class="op">=</span> <span class="cn">TRUE</span>, pch <span class="op">=</span> <span class="fl">19</span><span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/correlation-3.png"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># multicollinearity</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-forge.r-project.org/projects/car/" class="external-link">car</a></span><span class="op">)</span></span>
<span><span class="co">## Loading required package: carData</span></span>
<span><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">Zn</span> <span class="op">~</span> <span class="va">Slope</span> <span class="op">+</span> <span class="va">Water</span> <span class="op">+</span> <span class="va">NDVI</span> <span class="op">+</span> <span class="va">SOC</span> <span class="op">+</span> <span class="va">pH</span> <span class="op">+</span> <span class="va">Road</span> <span class="op">+</span> <span class="va">Mine</span>, data <span class="op">=</span> <span class="va">dt</span><span class="op">)</span></span>
<span><span class="fu">car</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/car/man/vif.html" class="external-link">vif</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span></span>
<span><span class="co">##    Slope    Water     NDVI      SOC       pH     Road     Mine </span></span>
<span><span class="co">## 1.651039 1.232454 1.459539 1.355824 1.568347 2.273387 2.608347</span></span></code></pre></div>
<p>In this step, the selected variables include Slope, Water, NDVI, SOC,
pH, Road, and Mine.</p>
</div>
<div class="section level3">
<h3 id="determining-the-optimal-similarity">2.2 Determining the optimal similarity<a class="anchor" aria-label="anchor" href="#determining-the-optimal-similarity"></a>
</h3>
<p>In the <code><a href="../reference/gos_bestkappa.html">gos_bestkappa()</a></code> function, if you set more
optional numbers to the <code>kappa</code> vector and a higher value of
the cross-validation repeat times <code>nrepeat</code>, a <span class="math inline">\(\kappa\)</span> value enabling more accurate
prediction will be selected, but the computation time will be increased.
You can specify the <code>cores</code> parameter to use multiple CPU
cores for parallel computing.</p>
<p><em>The default ratio of train set to test set in
<code><a href="../reference/gos_bestkappa.html">gos_bestkappa()</a></code> is <code>1:1</code>(<code>0.5</code>). You
can specify the ratio of train set to test set by <code>nsplit</code>
parameter</em></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span><span class="va">b1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gos_bestkappa.html">gos_bestkappa</a></span><span class="op">(</span><span class="va">Zn</span> <span class="op">~</span> <span class="va">Slope</span> <span class="op">+</span> <span class="va">Water</span> <span class="op">+</span> <span class="va">NDVI</span>  <span class="op">+</span> <span class="va">SOC</span> <span class="op">+</span> <span class="va">pH</span> <span class="op">+</span> <span class="va">Road</span> <span class="op">+</span> <span class="va">Mine</span>,</span>
<span>                    data <span class="op">=</span> <span class="va">dt</span>,</span>
<span>                    kappa <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                    nrepeat <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                    cores <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">##    user  system elapsed </span></span>
<span><span class="co">##    3.67    0.06    4.74</span></span>
<span><span class="va">b1</span><span class="op">$</span><span class="va">bestkappa</span></span>
<span><span class="co">## [1] 0.1</span></span>
<span><span class="va">b1</span><span class="op">$</span><span class="va">cvmean</span></span>
<span><span class="co">## # A tibble: 6 × 2</span></span>
<span><span class="co">##   kappa  rmse</span></span>
<span><span class="co">##   &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">## 1  0.01 0.681</span></span>
<span><span class="co">## 2  0.05 0.663</span></span>
<span><span class="co">## 3  0.1  0.659</span></span>
<span><span class="co">## 4  0.2  0.661</span></span>
<span><span class="co">## 5  0.5  0.664</span></span>
<span><span class="co">## 6  1    0.665</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span><span class="va">b2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gos_bestkappa.html">gos_bestkappa</a></span><span class="op">(</span><span class="va">Zn</span> <span class="op">~</span> <span class="va">Slope</span> <span class="op">+</span> <span class="va">Water</span> <span class="op">+</span> <span class="va">NDVI</span>  <span class="op">+</span> <span class="va">SOC</span> <span class="op">+</span> <span class="va">pH</span> <span class="op">+</span> <span class="va">Road</span> <span class="op">+</span> <span class="va">Mine</span>,</span>
<span>                    data <span class="op">=</span> <span class="va">dt</span>,</span>
<span>                    kappa <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">0.1</span>, <span class="fl">0.01</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">1</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                    nrepeat <span class="op">=</span> <span class="fl">10</span>,</span>
<span>                    cores <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">##    user  system elapsed </span></span>
<span><span class="co">##    0.01    0.02   17.05</span></span>
<span><span class="va">b2</span><span class="op">$</span><span class="va">bestkappa</span></span>
<span><span class="co">## [1] 0.08</span></span>
<span><span class="va">b2</span><span class="op">$</span><span class="va">cvmean</span></span>
<span><span class="co">## # A tibble: 19 × 2</span></span>
<span><span class="co">##    kappa  rmse</span></span>
<span><span class="co">##    &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">##  1  0.01 0.694</span></span>
<span><span class="co">##  2  0.02 0.680</span></span>
<span><span class="co">##  3  0.03 0.674</span></span>
<span><span class="co">##  4  0.04 0.672</span></span>
<span><span class="co">##  5  0.05 0.669</span></span>
<span><span class="co">##  6  0.06 0.667</span></span>
<span><span class="co">##  7  0.07 0.667</span></span>
<span><span class="co">##  8  0.08 0.667</span></span>
<span><span class="co">##  9  0.09 0.667</span></span>
<span><span class="co">## 10  0.1  0.667</span></span>
<span><span class="co">## 11  0.2  0.669</span></span>
<span><span class="co">## 12  0.3  0.671</span></span>
<span><span class="co">## 13  0.4  0.672</span></span>
<span><span class="co">## 14  0.5  0.672</span></span>
<span><span class="co">## 15  0.6  0.673</span></span>
<span><span class="co">## 16  0.7  0.673</span></span>
<span><span class="co">## 17  0.8  0.673</span></span>
<span><span class="co">## 18  0.9  0.673</span></span>
<span><span class="co">## 19  1    0.673</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/cowplot/" class="external-link">cowplot</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span><span class="va">b1</span><span class="op">$</span><span class="va">plot</span>,<span class="va">b2</span><span class="op">$</span><span class="va">plot</span>,nrow <span class="op">=</span> <span class="fl">1</span>,label_fontfamily <span class="op">=</span> <span class="st">'serif'</span>,</span>
<span>          labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'('</span>,<span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>,<span class="st">')'</span><span class="op">)</span>,</span>
<span>          label_fontface <span class="op">=</span> <span class="st">'plain'</span>,label_size <span class="op">=</span> <span class="fl">10</span>,</span>
<span>          hjust <span class="op">=</span> <span class="op">-</span><span class="fl">1.5</span>,align <span class="op">=</span> <span class="st">'hv'</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="../reference/figures/bestkappa-1.png" alt="Figure 1. Processes of determining the optimal similarity. (a) The optional kappa is (0.01, 0.05, 0.1, 0.2, 0.5, 1) and nrepeat is 2. (b) The optional kappa is (0.01, 0.02, …, 0.09, 0.1, 0.2, …, 1) and nrepeat is 10."><div class="figcaption">
<strong>Figure 1</strong>. Processes of
determining the optimal similarity. (a) The optional <code>kappa</code>
is (0.01, 0.05, 0.1, 0.2, 0.5, 1) and <code>nrepeat</code> is 2. (b) The
optional <code>kappa</code> is (0.01, 0.02, …, 0.09, 0.1, 0.2, …, 1) and
<code>nrepeat</code> is 10.</div>
</div>
</div>
<div class="section level3">
<h3 id="spatial-prediction">2.3 Spatial prediction<a class="anchor" aria-label="anchor" href="#spatial-prediction"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span><span class="va">g2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gos.html">gos</a></span><span class="op">(</span><span class="va">Zn</span> <span class="op">~</span> <span class="va">Slope</span> <span class="op">+</span> <span class="va">Water</span> <span class="op">+</span> <span class="va">NDVI</span>  <span class="op">+</span> <span class="va">SOC</span> <span class="op">+</span> <span class="va">pH</span> <span class="op">+</span> <span class="va">Road</span> <span class="op">+</span> <span class="va">Mine</span>,</span>
<span>          data <span class="op">=</span> <span class="va">dt</span>, newdata <span class="op">=</span> <span class="va">grid</span>, kappa <span class="op">=</span> <span class="fl">0.08</span>, cores <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">##    user  system elapsed </span></span>
<span><span class="co">##    0.03    0.00    5.86</span></span>
<span><span class="va">grid</span><span class="op">$</span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">g2</span><span class="op">$</span><span class="va">pred</span><span class="op">)</span></span>
<span><span class="va">grid</span><span class="op">$</span><span class="va">uc99</span> <span class="op">&lt;-</span> <span class="va">g2</span><span class="op">$</span><span class="va">`uncertainty99`</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sjmgarnier.github.io/viridis/" class="external-link">viridis</a></span><span class="op">)</span></span>
<span><span class="co">## Loading required package: viridisLite</span></span>
<span></span>
<span><span class="va">f1</span> <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">grid</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Lon</span>, y <span class="op">=</span> <span class="va">Lat</span>, fill <span class="op">=</span> <span class="va">pred</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html" class="external-link">scale_fill_viridis</a></span><span class="op">(</span>option<span class="op">=</span><span class="st">"magma"</span>, direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">'Prediction'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">f2</span> <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">grid</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Lon</span>, y <span class="op">=</span> <span class="va">Lat</span>, fill <span class="op">=</span> <span class="va">uc99</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html" class="external-link">scale_fill_viridis</a></span><span class="op">(</span>option<span class="op">=</span><span class="st">"mako"</span>, direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>fill<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote</a></span><span class="op">(</span><span class="va">Uncertainty</span><span class="op">~</span><span class="op">(</span><span class="va">zeta</span><span class="op">==</span><span class="fl">0.99</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span><span class="va">f1</span>,<span class="va">f2</span>,nrow <span class="op">=</span> <span class="fl">1</span>,label_fontfamily <span class="op">=</span> <span class="st">'serif'</span>,</span>
<span>          labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'('</span>,<span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>,<span class="st">')'</span><span class="op">)</span>,</span>
<span>          label_fontface <span class="op">=</span> <span class="st">'plain'</span>,label_size <span class="op">=</span> <span class="fl">10</span>,</span>
<span>          hjust <span class="op">=</span> <span class="op">-</span><span class="fl">1.5</span>,align <span class="op">=</span> <span class="st">'hv'</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="../reference/figures/gos_result-1.png" alt="Figure 2. Geographially optimal similarity (GOS)-based prediction (a) and uncertainty (b)."><div class="figcaption">
<strong>Figure 2</strong>. Geographially optimal
similarity (GOS)-based prediction (a) and uncertainty (b).</div>
</div>
<p>In addition, the following codes can be used to plot uncertainty
under different <span class="math inline">\(\zeta\)</span> values.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">uc</span> <span class="op">&lt;-</span> <span class="va">g2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"uncertainty"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html" class="external-link">bind_cols</a></span><span class="op">(</span><span class="va">grid</span><span class="op">[</span>,<span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>,<span class="va">.</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,</span>
<span>                      names_to <span class="op">=</span> <span class="st">"uncertainty"</span>,</span>
<span>                      values_to <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">uc</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Lon</span>, y <span class="op">=</span> <span class="va">Lat</span>, fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html" class="external-link">scale_fill_viridis</a></span><span class="op">(</span>option<span class="op">=</span><span class="st">"mako"</span>, direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">uncertainty</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">'Uncertainty'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="../reference/figures/uncertainty-1.png" alt="Figure 3. Geographially optimal similarity (GOS)-based spatial prediction uncertainties under different \zeta values."><div class="figcaption">
<strong>Figure 3</strong>. Geographially optimal
similarity (GOS)-based spatial prediction uncertainties under different
<span class="math inline">\(\zeta\)</span> values.</div>
</div>
</div>
<div class="section level3">
<h3 id="model-evaluation">2.4 Model evaluation<a class="anchor" aria-label="anchor" href="#model-evaluation"></a>
</h3>
<p>We can compare model accuracy of GOS with various models, such as
kriging, multivariate regression, regression kriging, random forest,
BCS, etc., as shown in <a href="https://doi.org/10.1007/s11004-022-10036-8" class="external-link">Song (2022)</a>. Here
is a simple example of comparing modeling accuracy between BCS and
GOS.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">99</span><span class="op">)</span></span>
<span><span class="co"># split data for validation: 50% training; 50% testing</span></span>
<span><span class="va">split</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">dt</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">dt</span><span class="op">)</span><span class="op">*</span><span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">train</span> <span class="op">&lt;-</span> <span class="va">dt</span><span class="op">[</span><span class="va">split</span>,<span class="op">]</span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="va">dt</span><span class="op">[</span><span class="op">-</span><span class="va">split</span>,<span class="op">]</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://andrisignorell.github.io/DescTools/" class="external-link">DescTools</a></span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'DescTools'</span></span>
<span><span class="co">## The following object is masked from 'package:car':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     Recode</span></span>
<span><span class="co"># BCS</span></span>
<span><span class="va">h1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gos.html">gos</a></span><span class="op">(</span><span class="va">Zn</span> <span class="op">~</span> <span class="va">Slope</span> <span class="op">+</span> <span class="va">Water</span> <span class="op">+</span> <span class="va">NDVI</span>  <span class="op">+</span> <span class="va">SOC</span> <span class="op">+</span> <span class="va">pH</span> <span class="op">+</span> <span class="va">Road</span> <span class="op">+</span> <span class="va">Mine</span>,</span>
<span>          data <span class="op">=</span> <span class="va">train</span>, newdata <span class="op">=</span> <span class="va">test</span>, kappa <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://andrisignorell.github.io/DescTools/reference/MAE.html" class="external-link">MAE</a></span><span class="op">(</span><span class="va">test</span><span class="op">$</span><span class="va">Zn</span>, <span class="va">h1</span><span class="op">$</span><span class="va">pred</span><span class="op">)</span></span>
<span><span class="co">## [1] 0.5158373</span></span>
<span><span class="fu"><a href="https://andrisignorell.github.io/DescTools/reference/MAE.html" class="external-link">RMSE</a></span><span class="op">(</span><span class="va">test</span><span class="op">$</span><span class="va">Zn</span>, <span class="va">h1</span><span class="op">$</span><span class="va">pred</span><span class="op">)</span></span>
<span><span class="co">## [1] 0.6599409</span></span>
<span></span>
<span><span class="co"># GOS</span></span>
<span><span class="va">h2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gos.html">gos</a></span><span class="op">(</span><span class="va">Zn</span> <span class="op">~</span> <span class="va">Slope</span> <span class="op">+</span> <span class="va">Water</span> <span class="op">+</span> <span class="va">NDVI</span>  <span class="op">+</span> <span class="va">SOC</span> <span class="op">+</span> <span class="va">pH</span> <span class="op">+</span> <span class="va">Road</span> <span class="op">+</span> <span class="va">Mine</span>,</span>
<span>          data <span class="op">=</span> <span class="va">train</span>, newdata <span class="op">=</span> <span class="va">test</span>, kappa <span class="op">=</span> <span class="fl">0.08</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://andrisignorell.github.io/DescTools/reference/MAE.html" class="external-link">MAE</a></span><span class="op">(</span><span class="va">test</span><span class="op">$</span><span class="va">Zn</span>, <span class="va">h2</span><span class="op">$</span><span class="va">pred</span><span class="op">)</span></span>
<span><span class="co">## [1] 0.5089462</span></span>
<span><span class="fu"><a href="https://andrisignorell.github.io/DescTools/reference/MAE.html" class="external-link">RMSE</a></span><span class="op">(</span><span class="va">test</span><span class="op">$</span><span class="va">Zn</span>, <span class="va">h2</span><span class="op">$</span><span class="va">pred</span><span class="op">)</span></span>
<span><span class="co">## [1] 0.6523436</span></span></code></pre></div>
<p>As a result, the MAE of BCS is 0.5158 and the MAE of GOS is 0.5089,
the RMSE of BCS is 0.6599 and the RMSE of GOS is 0.6523. Compared with
BCS, GOS reduced 1.34% of MAE and 1.15% of RMSE.</p>
<p> </p>
<p>   </p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://yongzesong.com/" class="external-link">Yongze Song</a>, <a href="https://spatlyu.github.io/" class="external-link">Wenbo Lv</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
